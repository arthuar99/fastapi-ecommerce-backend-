<!-- Product Modal -->
<div id="productModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-xl max-w-2xl w-full max-h-screen overflow-y-auto">
        <!-- Modal Header -->
        <div class="flex items-center justify-between p-6 border-b border-gray-200">
            <h3 class="text-xl font-semibold text-gray-900" id="modalTitle">إضافة منتج جديد</h3>
            <button onclick="closeProductModal()" class="text-gray-400 hover:text-gray-600">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        
        <!-- Modal Body -->
        <div class="p-6">
            <form id="productForm" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Product Name -->
                    <div class="md:col-span-2">
                        <label for="productName" class="block text-sm font-medium text-gray-700 mb-2">
                            اسم المنتج <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="productName" name="name" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"
                               placeholder="أدخل اسم المنتج">
                    </div>
                    
                    <!-- Category -->
                    <div>
                        <label for="productCategory" class="block text-sm font-medium text-gray-700 mb-2">الفئة</label>
                        <select id="productCategory" name="category" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                            <option value="">اختر الفئة</option>
                            <option value="electronics">إلكترونيات</option>
                            <option value="clothing">ملابس</option>
                            <option value="books">كتب</option>
                            <option value="home">منزل ومطبخ</option>
                            <option value="sports">رياضة</option>
                            <option value="beauty">جمال</option>
                        </select>
                    </div>
                    
                    <!-- Price -->
                    <div>
                        <label for="productPrice" class="block text-sm font-medium text-gray-700 mb-2">
                            السعر (ج.م) <span class="text-red-500">*</span>
                        </label>
                        <input type="number" id="productPrice" name="price" required step="0.01" min="0"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"
                               placeholder="0.00">
                    </div>
                    
                    <!-- Stock -->
                    <div>
                        <label for="productStock" class="block text-sm font-medium text-gray-700 mb-2">
                            الكمية المتاحة <span class="text-red-500">*</span>
                        </label>
                        <input type="number" id="productStock" name="stock" required min="0"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"
                               placeholder="0">
                    </div>
                    
                    <!-- SKU -->
                    <div>
                        <label for="productSku" class="block text-sm font-medium text-gray-700 mb-2">رمز المنتج (SKU)</label>
                        <input type="text" id="productSku" name="sku" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"
                               placeholder="مثال: PROD-001">
                    </div>
                </div>
                
                <!-- Description -->
                <div>
                    <label for="productDescription" class="block text-sm font-medium text-gray-700 mb-2">الوصف</label>
                    <textarea id="productDescription" name="description" rows="4"
                              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"
                              placeholder="اكتب وصفاً مفصلاً للمنتج"></textarea>
                </div>
                
                <!-- Image Upload -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">صورة المنتج</label>
                    <div class="flex items-center justify-center w-full">
                        <label for="productImage" class="flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100">
                            <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-2"></i>
                                <p class="mb-2 text-sm text-gray-500">
                                    <span class="font-semibold">اضغط لرفع</span> أو اسحب وأفلت
                                </p>
                                <p class="text-xs text-gray-500">PNG, JPG أو GIF (الحد الأقصى: 5MB)</p>
                            </div>
                            <input id="productImage" name="image" type="file" class="hidden" accept="image/*" onchange="handleImageUpload(this)">
                        </label>
                    </div>
                    <div id="imagePreview" class="mt-4 hidden">
                        <img id="previewImg" class="w-32 h-32 object-cover rounded-lg" alt="معاينة الصورة">
                    </div>
                </div>
                
                <!-- Additional Options -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Weight -->
                    <div>
                        <label for="productWeight" class="block text-sm font-medium text-gray-700 mb-2">الوزن (كجم)</label>
                        <input type="number" id="productWeight" name="weight" step="0.1" min="0"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"
                               placeholder="0.0">
                    </div>
                    
                    <!-- Dimensions -->
                    <div>
                        <label for="productDimensions" class="block text-sm font-medium text-gray-700 mb-2">الأبعاد (سم)</label>
                        <input type="text" id="productDimensions" name="dimensions" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"
                               placeholder="الطول × العرض × الارتفاع">
                    </div>
                </div>
                
                <!-- Status and Visibility -->
                <div class="flex items-center space-x-6 space-x-reverse">
                    <div class="flex items-center">
                        <input id="productActive" name="is_active" type="checkbox" checked
                               class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded">
                        <label for="productActive" class="mr-2 block text-sm text-gray-900">منتج نشط</label>
                    </div>
                    
                    <div class="flex items-center">
                        <input id="productFeatured" name="is_featured" type="checkbox"
                               class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded">
                        <label for="productFeatured" class="mr-2 block text-sm text-gray-900">منتج مميز</label>
                    </div>
                </div>
            </form>
        </div>
        
        <!-- Modal Footer -->
        <div class="flex items-center justify-end space-x-3 space-x-reverse px-6 py-4 border-t border-gray-200">
            <button type="button" onclick="closeProductModal()" 
                    class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors duration-200">
                إلغاء
            </button>
            <button type="button" onclick="saveProduct()" 
                    class="px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors duration-200">
                <span id="saveButtonText">حفظ المنتج</span>
                <div id="saveButtonSpinner" class="loading-spinner hidden ml-2"></div>
            </button>
        </div>
    </div>
</div>

<script>
// Product Modal Functions
function closeProductModal() {
    document.getElementById('productModal').classList.add('hidden');
    document.getElementById('productForm').reset();
    document.getElementById('imagePreview').classList.add('hidden');
}

function handleImageUpload(input) {
    const file = input.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const preview = document.getElementById('imagePreview');
            const previewImg = document.getElementById('previewImg');
            previewImg.src = e.target.result;
            preview.classList.remove('hidden');
        };
        reader.readAsDataURL(file);
    }
}

function saveProduct() {
    const form = document.getElementById('productForm');
    const formData = new FormData(form);
    
    // Basic validation
    if (!formData.get('name') || !formData.get('price') || !formData.get('stock')) {
        showToast('يرجى ملء جميع الحقول المطلوبة', 'error');
        return;
    }
    
    // Show loading state
    const saveButton = document.getElementById('saveButtonText');
    const spinner = document.getElementById('saveButtonSpinner');
    saveButton.textContent = 'جارٍ الحفظ...';
    spinner.classList.remove('hidden');
    
    // Simulate API call
    setTimeout(() => {
        showToast('تم حفظ المنتج بنجاح!', 'success');
        closeProductModal();
        
        // Reset button state
        saveButton.textContent = 'حفظ المنتج';
        spinner.classList.add('hidden');
        
        // Optionally refresh the products list
        // location.reload();
    }, 2000);
}

// Edit product function (would be called from products list)
function editProductModal(productId, productData) {
    // Fill form with existing data
    document.getElementById('modalTitle').textContent = 'تحرير المنتج';
    document.getElementById('productName').value = productData.name;
    document.getElementById('productCategory').value = productData.category;
    document.getElementById('productPrice').value = productData.price;
    document.getElementById('productStock').value = productData.stock;
    document.getElementById('productSku').value = productData.sku || '';
    document.getElementById('productDescription').value = productData.description || '';
    document.getElementById('productWeight').value = productData.weight || '';
    document.getElementById('productDimensions').value = productData.dimensions || '';
    document.getElementById('productActive').checked = productData.is_active;
    document.getElementById('productFeatured').checked = productData.is_featured;
    
    // Show modal
    document.getElementById('productModal').classList.remove('hidden');
}
</script>
